[
  {
    "definition": " SELECT (md5(('facebook_ads'::text || (fa.id)::text)))::uuid AS id,\n    fa.company_id,\n    c.name AS company_name,\n    c.company_key,\n    'facebook_ads'::text AS source_table,\n    'NEW_AD_LAUNCH'::text AS event_type,\n        CASE\n            WHEN ((fa.snapshot_date IS NOT NULL) AND (fa.snapshot_date <> ''::text)) THEN ((fa.snapshot_date || ' 12:00:00'::text))::timestamp with time zone\n            ELSE fa.created_at\n        END AS created_at,\n    COALESCE(fa.page_name, fa.handle, 'Facebook Ad'::text) AS headline,\n    \"left\"(COALESCE(fa.ad_text, 'New ad launched'::text), 200) AS description,\n    'MEDIUM'::text AS severity,\n    fa.ad_image_url AS image_url,\n    (fa.id)::text AS source_record_id,\n    1 AS event_count,\n    ARRAY[fa.ad_image_url] AS related_images\n   FROM (facebook_ads fa\n     LEFT JOIN companies c ON ((fa.company_id = c.id)))\nUNION ALL\n SELECT (md5(('google_ads'::text || (ga.id)::text)))::uuid AS id,\n    ga.company_id,\n    c.name AS company_name,\n    c.company_key,\n    'google_ads'::text AS source_table,\n    'NEW_AD_LAUNCH'::text AS event_type,\n        CASE\n            WHEN ((ga.snapshot_date IS NOT NULL) AND (ga.snapshot_date <> ''::text)) THEN ((ga.snapshot_date || ' 12:00:00'::text))::timestamp with time zone\n            ELSE ga.created_at\n        END AS created_at,\n    ('Google Ad: '::text || COALESCE(ga.format, 'Unknown'::text)) AS headline,\n    ('Region: '::text || COALESCE(ga.region_name, 'Global'::text)) AS description,\n    'MEDIUM'::text AS severity,\n    ga.image_url,\n    (ga.id)::text AS source_record_id,\n    1 AS event_count,\n    ARRAY[ga.image_url] AS related_images\n   FROM (google_ads ga\n     LEFT JOIN companies c ON ((ga.company_id = c.id)))\nUNION ALL\n SELECT (md5(('instagram_posts'::text || (ip.id)::text)))::uuid AS id,\n    ip.company_id,\n    c.name AS company_name,\n    c.company_key,\n    'instagram_posts'::text AS source_table,\n    'SOCIAL_POST'::text AS event_type,\n        CASE\n            WHEN ((ip.snapshot_date IS NOT NULL) AND (ip.snapshot_date <> ''::text)) THEN ((ip.snapshot_date || ' 12:00:00'::text))::timestamp with time zone\n            ELSE ip.created_at\n        END AS created_at,\n    ('Instagram: '::text || COALESCE(ip.username, ip.handle)) AS headline,\n    \"left\"(COALESCE(ip.text, 'New post'::text), 200) AS description,\n    'LOW'::text AS severity,\n    ip.display_uri AS image_url,\n    (ip.id)::text AS source_record_id,\n    1 AS event_count,\n    ARRAY[ip.display_uri] AS related_images\n   FROM (instagram_posts ip\n     LEFT JOIN companies c ON ((ip.company_id = c.id)))\nUNION ALL\n SELECT cs.id,\n    cs.company_id,\n    c.name AS company_name,\n    c.company_key,\n    'company_screenshots'::text AS source_table,\n        CASE\n            WHEN (cs.promotions_detected IS TRUE) THEN 'PROMO_DETECTED'::text\n            ELSE 'SCREENSHOT_CAPTURED'::text\n        END AS event_type,\n    cs.created_at,\n        CASE\n            WHEN (cs.promotions_detected IS TRUE) THEN 'Promotion Detected'::text\n            ELSE 'Website Screenshot'::text\n        END AS headline,\n    COALESCE(cs.marketing_intent, 'Screenshot processed'::text) AS description,\n    'LOW'::text AS severity,\n    cs.image_url,\n    (cs.id)::text AS source_record_id,\n    1 AS event_count,\n    ARRAY[cs.image_url] AS related_images\n   FROM (company_screenshots cs\n     LEFT JOIN companies c ON ((cs.company_id = c.id)))\n  WHERE (cs.marketing_intent <> 'PENDING_N8N_UPDATE'::text);"
  }
]